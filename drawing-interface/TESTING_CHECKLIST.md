# 打印机连接功能测试清单

## 测试前准备

- [ ] 确保使用Chrome或Edge浏览器
- [ ] 通过localhost访问 (`./start-server.sh`)
- [ ] 准备Ender 3 Pro或Ender 5打印机（可选，用于真实连接测试）

## 功能测试清单

### 1. UI元素检查 ✅

- [ ] 打开应用，检查右侧面板是否有"打印模式"选项
- [ ] 默认应该选中"模拟模式"
- [ ] 打印机控制区域（下拉菜单、按钮）应该隐藏
- [ ] 打印机状态面板应该隐藏

### 2. 模式切换测试 ✅

- [ ] 点击"真实打印"单选按钮
- [ ] 确认以下元素显示：
  - [ ] 打印机型号下拉菜单（显示Ender 3 Pro和Ender 5）
  - [ ] "连接打印机"和"断开连接"按钮
  - [ ] "开始打印"和"停止打印"按钮
  - [ ] 打印机状态面板（连接状态：未连接，打印状态：就绪）
- [ ] 切换回"模拟模式"
- [ ] 确认打印机控制区域再次隐藏

### 3. 打印机配置加载测试 ✅

- [ ] 切换到"真实打印"模式
- [ ] 选择"Ender 3 Pro"
- [ ] 打开浏览器控制台（F12）
- [ ] 检查是否有日志：`Printer config loaded: {...}`
- [ ] 切换到"Ender 5"
- [ ] 确认配置已加载（Z高度应为300mm）

### 4. 串口连接测试（无打印机）🔧

- [ ] 点击"连接打印机"按钮
- [ ] 应弹出浏览器串口选择对话框
- [ ] 如果没有打印机连接，应该看到"无设备"或可以取消
- [ ] 取消对话框
- [ ] 连接状态应保持"未连接"

### 5. Drawing Mode模拟测试 ✅

- [ ] 确保在Drawing Mode
- [ ] 使用任意工具绘制几条路径
- [ ] 保持在"模拟模式"
- [ ] 点击"Simulate"按钮
- [ ] 确认3D可视化正常工作

### 6. Drawing Mode G-code生成测试 ✅

- [ ] 绘制一些路径（建议至少3条）
- [ ] 切换到"真实打印"模式
- [ ] 打开浏览器控制台
- [ ] 点击"开始打印"按钮
- [ ] 在确认对话框点击"取消"（不实际打印）
- [ ] 检查控制台是否输出G-code预览：
  ```
  === G-code Preview ===
  ; Generated by GlyphForge Drawing Interface
  ...
  === End Preview ===
  ```
- [ ] 检查G-code内容是否包含：
  - [ ] 初始化命令（G21, G90, G28）
  - [ ] 移动到绘图高度（G0 Z2）
  - [ ] 路径移动命令（G0, G1）
  - [ ] 结束命令（G28, M84）

### 7. Robot Mode模拟测试 ✅

- [ ] 切换到Robot Mode
- [ ] 放置几个物体
- [ ] 为每个物体设置目标位置
- [ ] 保持在"模拟模式"
- [ ] 点击"Simulate"按钮
- [ ] 确认机器人动画正常执行

### 8. Robot Mode G-code生成测试 ✅

- [ ] 在Robot Mode放置至少2个物体并设置目标位置
- [ ] 切换到"真实打印"模式
- [ ] 打开浏览器控制台
- [ ] 点击"开始打印"按钮
- [ ] 点击"取消"（不实际打印）
- [ ] 检查控制台G-code预览
- [ ] 确认包含：
  - [ ] 归零命令
  - [ ] 移动到抓取位置
  - [ ] [GRIP] 和 [RELEASE] 标记
  - [ ] 安全高度移动

### 9. 按钮状态测试 ✅

#### 未连接状态
- [ ] "连接打印机" - 启用
- [ ] "断开连接" - 禁用
- [ ] "开始打印" - 禁用
- [ ] "停止打印" - 禁用

#### 连接状态（模拟测试，如果有打印机）
- [ ] "连接打印机" - 禁用
- [ ] "断开连接" - 启用
- [ ] "开始打印" - 启用
- [ ] "停止打印" - 禁用

### 10. 边界情况测试 ✅

#### 无路径/物体时打印
- [ ] 不绘制任何路径
- [ ] 尝试开始打印
- [ ] 应显示警告："没有可打印的路径"

#### Robot Mode无目标时打印
- [ ] 放置物体但不设置目标位置
- [ ] 尝试开始打印
- [ ] 应显示警告："没有设置目标位置的物体"

#### 未连接时打印
- [ ] 确保未连接打印机
- [ ] 开始打印按钮应该禁用
- [ ] 即使强制触发，应显示："请先连接打印机"

### 11. 坐标转换测试 📐

- [ ] 绘制一个矩形路径（例如从左上角到右下角）
- [ ] 生成G-code并检查坐标
- [ ] 验证：
  - [ ] X坐标在0-220范围内（Ender 3/5）
  - [ ] Y坐标在0-220范围内
  - [ ] Y轴已正确翻转（画布上方 → 打印机下方）

### 12. CSS样式测试 🎨

- [ ] 检查打印机选择下拉框样式
- [ ] 悬停按钮时有高亮效果
- [ ] 连接状态颜色正确：
  - [ ] 未连接 - 红色
  - [ ] 连接中 - 黄色
  - [ ] 已连接 - 绿色
  - [ ] 打印中 - 蓝色（带脉动动画）

### 13. 实际打印机连接测试（需要硬件）🖨️

**仅在有Ender 3 Pro或Ender 5时测试**

#### 连接测试
- [ ] 打印机通过USB连接并开机
- [ ] 点击"连接打印机"
- [ ] 选择正确的串口
- [ ] 确认连接成功
- [ ] 状态显示"已连接"

#### 简单命令测试
- [ ] 打开浏览器控制台
- [ ] 运行命令：`app.printerManager.fab.add('G28'); app.printerManager.fab.print();`
- [ ] 打印机应执行归零操作

#### 实际打印测试
- [ ] 绘制简单的小路径（建议10cm x 10cm以内）
- [ ] 确认打印床清洁
- [ ] 开始打印
- [ ] 观察打印机执行动作
- [ ] 必要时使用"停止打印"紧急停止

## 已知问题和限制 ⚠️

1. **浏览器兼容性**
   - 仅Chrome/Edge支持WebSerial
   - Firefox和Safari不支持

2. **安全限制**
   - 必须通过HTTPS或localhost访问
   - 需要用户手动授权串口访问

3. **G-code限制**
   - 当前不支持加热命令（已注释）
   - Robot Mode的[GRIP]/[RELEASE]是注释，需要实际机械手硬件

4. **坐标系统**
   - 假设打印机原点在左下角
   - 不同打印机可能需要调整

## 测试环境信息

- **测试日期**: _______________
- **浏览器**: Chrome / Edge（版本：_____）
- **操作系统**: Windows / macOS / Linux
- **打印机型号**（如有）: _______________
- **测试人员**: _______________

## 测试结果总结

### 通过的测试
- [ ] 所有UI元素正常显示
- [ ] 模式切换功能正常
- [ ] G-code生成逻辑正确
- [ ] 按钮状态管理正确
- [ ] 错误处理适当

### 发现的问题

1. 
2. 
3. 

### 改进建议

1. 
2. 
3. 

## 下一步行动

- [ ] 修复发现的问题
- [ ] 优化G-code生成
- [ ] 添加更多打印机型号支持
- [ ] 改进错误提示信息
- [ ] 编写自动化测试

---

**测试完成**: ☐ 是 ☐ 否  
**可以发布**: ☐ 是 ☐ 否

